import { useState } from "react";

export default function MontyHallSimulator() {
  const boxes = ["A", "B", "C"];
  const [prizeBox, setPrizeBox] = useState(() => randomBox());
  const [playerChoice, setPlayerChoice] = useState(null);
  const [hostOpen, setHostOpen] = useState(null);
  const [result, setResult] = useState(null);
  const [stats, setStats] = useState({ stayWins: 0, switchWins: 0, total: 0 });

  function randomBox() {
    return boxes[Math.floor(Math.random() * boxes.length)];
  }

  function startGame() {
    setPrizeBox(randomBox());
    setPlayerChoice(null);
    setHostOpen(null);
    setResult(null);
  }

  function playerPick(box) {
    setPlayerChoice(box);

    // ä¸»æŒäººæ‰“é–‹ä¸€å€‹æ²’çå“ä¸”ä¸æ˜¯ç©å®¶é¸çš„ç®±å­
    const possibleOpens = boxes.filter(
      (b) => b !== box && b !== prizeBox
    );
    const openBox = possibleOpens[Math.floor(Math.random() * possibleOpens.length)];
    setHostOpen(openBox);
  }

  function makeFinalChoice(switchChoice) {
    let finalChoice = playerChoice;
    if (switchChoice) {
      // æ›ç®±ï¼šé¸å‰©ä¸‹æœªé–‹ä¸”æœªé¸çš„ç®±å­
      finalChoice = boxes.find(
        (b) => b !== playerChoice && b !== hostOpen
      );
    }
    const win = finalChoice === prizeBox;

    setResult(win ? "è´äº†ï¼ğŸ‰" : "æ²’ä¸­çï¼Œå†è©¦è©¦ï¼");
    setStats((prev) => {
      const newStats = { ...prev, total: prev.total + 1 };
      if (switchChoice && win) newStats.switchWins++;
      else if (!switchChoice && win) newStats.stayWins++;
      return newStats;
    });
  }

  return (
    <div style={{ maxWidth: 400, margin: "auto", fontFamily: "sans-serif" }}>
      <h2>ä¸‰ç®±å•é¡Œæ¨¡æ“¬å™¨</h2>
      <button onClick={startGame} disabled={playerChoice !== null}>
        é–‹å§‹æ–°éŠæˆ²
      </button>

      {playerChoice === null && (
        <div style={{ marginTop: 20 }}>
          <p>è«‹é¸æ“‡ä¸€å€‹ç®±å­ï¼š</p>
          {boxes.map((box) => (
            <button key={box} onClick={() => playerPick(box)} style={{ margin: 5 }}>
              ç®±å­ {box}
            </button>
          ))}
        </div>
      )}

      {playerChoice !== null && hostOpen !== null && result === null && (
        <div style={{ marginTop: 20 }}>
          <p>ä½ é¸äº†ç®±å­ {playerChoice}ï¼Œä¸»æŒäººæ‰“é–‹äº†ç®±å­ {hostOpen}ï¼ˆæ²’çå“ï¼‰ã€‚</p>
          <p>æ˜¯å¦æ›æˆå¦ä¸€å€‹æœªé–‹çš„ç®±å­ï¼Ÿ</p>
          <button onClick={() => makeFinalChoice(false)} style={{ marginRight: 10 }}>
            ä¸æ›
          </button>
          <button onClick={() => makeFinalChoice(true)}>æ›ç®±</button>
        </div>
      )}

      {result !== null && (
        <div style={{ marginTop: 20 }}>
          <p>{result}</p>
          <p>
            çµ±è¨ˆï¼šç¸½éŠæˆ²æ•¸ {stats.total} æ¬¡ï¼Œæ›ç®±è´ {stats.switchWins} æ¬¡ï¼Œä¸æ›è´ {stats.stayWins} æ¬¡ã€‚
          </p>
          <button onClick={startGame}>å†ç©ä¸€æ¬¡</button>
        </div>
      )}
    </div>
  );
}
